<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <h2>index07 : closure</h2>
  <script>
    //Lexical scope : 함수의 선언 위치에 따라서 상위 스코프를 결정하게 된다.
    var a = 1;
    function x() {
      a = 10;
      console.log("a : "  + a); //10
    }
    x();  //10

    /*
    var b = 1;
    function y() {
      var b = 10;
      console.log("b : " + b);  //10
      z();
    }
    function z() {
      console.log(b); //1
    }
    y();  //1
    */

    var b = 1;
    function y() {
      var b = 10;
      console.log("b : " + b);  //10
      (function () {
        console.log(b)  //10
      })();
    }
    y();  //10
    console.log("y() : " + y()); //undefined -> return이 없기 때문

    //클로저 : 내부함수를 이용하여 외부함수(c)의 변수에 접근할 수 있는 환경을 만들어 준다.
    function func1() {
      var c = 1;

      // var d = function() {
      //   return c;
      // }
      // return d; -> 아래 식과 동일
      return function() {return c;};
    }   //c의 범위는 여기까쥐
    // console.log("c : " + c); -> Error: c is not defined
    var result = func1();
    console.log("result : " + result());  //result : 1
    var x = result();
    //func2 : func1 주석 제외 깔끔하게 다시 작성한 것
    function func2() {
      var e = 3;
      return function() {return e;};
    }
    var res = func2();
    var temp = res();
    console.log("res : " + res);  //res : function() {return e;}
    console.log("res : " + res());  //res : 3
    console.log("temp : " + temp);  //temp : 3

    //closure 예제0
    function compute() {
      var count = 0;
      return function() {
        return ++count;
      }
    }
    console.log("compute : " + compute);
    console.log("compute() : " + compute());  //function() {return ++count;}
    var computeRes = compute();
    console.log("computeRes() : " + computeRes());  //1
    console.log("computeRes() : " + computeRes());  //2
    console.log("computeRes() : " + computeRes());  //3

    //closure 예제1
    function makeFunc() {
      var name = "Mozilla";
      function displayName() {
        console.log("name : " + name);
      }
      return displayName;
    }

    var myFunc = makeFunc();  //name : Mozilla
    //myFunc변수에 displayName을 리턴함
    //유효범위의 어휘적 환경을 유지
    console.log(makeFunc());  //function displayName() {console.log("name" + name);}
    myFunc(); //name : Mozilla
    //리턴된 displayName 함수를 실행(name 변수에 접근)

    //closure 예제2
    function makeAdder(x) {
      var y = 1;
      return function(z) {
        y = 100;
        return x + y + z;
      };
    }
    var add5 = makeAdder(5);
    var add10 = makeAdder(10);
    //클로저에 x와 y의 환경이 저장됨
    console.log("add5(2) : " + add5(2));  // 107 (x:5 + y:100 + z:2)
    console.log("add10(2) : " + add10(2)); // 112 (x:10 + y:100 + z:2)

  </script>
</body>

</html>